# Защищенные маршруты React + Keycloak + Mobx

### Keycloak нужен для авторизации пользователя при переходе на защищенные маршруты. Полезная информация, которая берется из Keycloak:

#### - Роль

#### - Логин

#### - ФИО

### Дополнительная информация, получаемая из БД PostgreSQL:

#### - children - сотрудники, на страницы которых может переходить пользователь (подчиненные)

#### - departments - департаменты, на страницы которых может переходить пользователь (подчиненные)

#### - ФИО руководителя пользователя

#### - Название департамента, в который входит пользователь

### После запроса к БД данная информация собирается в один объект с данными из Keycloak и заносится в Mobx, далее в приложении нужно получать информацию о пользователе из Mobx стейта (user.user.PROPERTY)

## Компоненты

### App

#### Корневой компонент

#### В нем происходит проверка инициализации keycloak и авторизации пользователя

#### Если пользователь авторизован, то делается запрос в БД, результат хранится в Mobx

#### Все маршруты обернуты в компонент Protect

### Protect

#### Проверка возможности перехода на страницы

#### В качестве пропса role можно передавать массив ролей пользователя, для которых будет доступна эта страница

#### Проверка children через const {name} = useParams()

#### Также происходит проверка по children из стейта user'а, пользователь может переходить только на те страницы которые есть в children, проверка по name, name приходит со страницы, на которую совершается переход

#### Если проверка не пройдена, то есть сотрудника нет в списке подчиненных (children) или роль пользователя не позволяет перейти на эту страницу, происходит редирект на главную страницу

#### Если protect видит, что пользователь не авторизован, то есть при попытке зайти без авторизации на защищенную страницу - редирект на страницу авторизации

## Страницы

### Home

#### Главная страница, доступна всем авторизованным пользователям

### Other

#### Страница с полной защитой (проверка на авторизацию, роль и возможность просмотра данной страницы по подчиненности)

### Login

#### Страница авторизации, логика заключается в том, что происходит проверка авторизации пользователя, если она не пройдена то вызывается функция логина keycloak, если проверка пройдена, редирект на главную страницу
